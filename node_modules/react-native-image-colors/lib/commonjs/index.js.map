{"version":3,"sources":["index.ts"],"names":["MAX_KEY_LEN","ImageColors","RNImageColors","NativeModules","resolveImageSource","source","Image","resolveAssetSource","uri","getColors","config","resolvedSrc","cache","cachedResult","key","getItem","result","length","Error","setItem"],"mappings":";;;;;;;AAAA;;AACA;;AAIA,MAAMA,WAAW,GAAG,GAApB;AAEA,MAAM;AAAEC,EAAAA,WAAW,EAAEC;AAAf,IAAiCC,0BAAvC;;AAEA,MAAMC,kBAAkB,GAAIC,MAAD,IAAiD;AAC1E,MAAI,OAAOA,MAAP,KAAkB,QAAtB,EAAgC;AAC9B,WAAOA,MAAP;AACD,GAFD,MAEO;AACL,WAAOC,mBAAMC,kBAAN,CAAyBF,MAAzB,EAAiCG,GAAxC;AACD;AACF,CAND;;AAQA,MAAMC,SAA2C,GAAG,OAAOJ,MAAP,EAAeK,MAAf,KAA0B;AAC5E,QAAMC,WAAW,GAAGP,kBAAkB,CAACC,MAAD,CAAtC;;AAEA,MAAIK,MAAJ,aAAIA,MAAJ,eAAIA,MAAM,CAAEE,KAAZ,EAAmB;AACjB,UAAMC,YAAY,GAAGH,MAAM,CAACI,GAAP,GACjBF,aAAMG,OAAN,CAAcL,MAAM,CAACI,GAArB,CADiB,GAEjBF,aAAMG,OAAN,CAAcJ,WAAd,CAFJ;AAIA,QAAIE,YAAJ,EAAkB,OAAOA,YAAP;AACnB;;AAED,QAAMG,MAAM,GAAG,MAAMd,aAAa,CAACO,SAAd,CAAwBE,WAAxB,EAAqCD,MAArC,CAArB;;AAEA,MAAIA,MAAJ,aAAIA,MAAJ,eAAIA,MAAM,CAAEE,KAAZ,EAAmB;AAAA;;AACjB,QAAI,CAACF,MAAM,CAACI,GAAR,IAAeH,WAAW,CAACM,MAAZ,GAAqBjB,WAAxC,EAAqD;AACnD,YAAM,IAAIkB,KAAJ,CACH,iIAAgIlB,WAAY,mCADzI,CAAN;AAGD;;AAEDY,iBAAMO,OAAN,gBAAcT,MAAM,CAACI,GAArB,qDAA4BH,WAA5B,EAAyCK,MAAzC;AACD;;AAED,SAAOA,MAAP;AACD,CAxBD;;AA0BA,MAAMf,WAAgC,GAAG;AACvCQ,EAAAA,SADuC;AAEvCG,EAAAA,KAAK,EAALA;AAFuC,CAAzC;eAKeX,W","sourcesContent":["import { NativeModules, Image } from 'react-native'\nimport { cache } from './cache'\nimport type { ImageRequireSource } from 'react-native'\nimport type { RNImageColorsModule } from './types'\n\nconst MAX_KEY_LEN = 500\n\nconst { ImageColors: RNImageColors } = NativeModules\n\nconst resolveImageSource = (source: string | ImageRequireSource): string => {\n  if (typeof source === 'string') {\n    return source\n  } else {\n    return Image.resolveAssetSource(source).uri\n  }\n}\n\nconst getColors: RNImageColorsModule['getColors'] = async (source, config) => {\n  const resolvedSrc = resolveImageSource(source)\n\n  if (config?.cache) {\n    const cachedResult = config.key\n      ? cache.getItem(config.key)\n      : cache.getItem(resolvedSrc)\n\n    if (cachedResult) return cachedResult\n  }\n\n  const result = await RNImageColors.getColors(resolvedSrc, config)\n\n  if (config?.cache) {\n    if (!config.key && resolvedSrc.length > MAX_KEY_LEN) {\n      throw new Error(\n        `You enabled caching, but you didn't pass a key. We fallback to using the image URI as the key. However the URI is longer than ${MAX_KEY_LEN}. Please pass a short unique key.`\n      )\n    }\n\n    cache.setItem(config.key ?? resolvedSrc, result)\n  }\n\n  return result\n}\n\nconst ImageColors: RNImageColorsModule = {\n  getColors,\n  cache,\n}\n\nexport default ImageColors\n"]}